<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>For You</title>
  <style>
    :root{
      --bg1:#ffe7f2;
      --bg2:#e7f0ff;
      --card:#ffffffcc;
      --card2:#ffffffee;
      --text:#1f2340;
      --muted:#5c628a;
      --btn:#1f2340;
      --btnText:#fff;
      --btn2:#ffffff;
      --shadow: 0 18px 45px rgba(31,35,64,.18);
      --shadow2: 0 10px 30px rgba(31,35,64,.12);
      --radius: 22px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 900px at 20% 10%, var(--bg1), transparent 55%),
        radial-gradient(1200px 900px at 80% 20%, var(--bg2), transparent 55%),
        linear-gradient(180deg, #fff0f7, #eef5ff);
      overflow-x:hidden;
    }

    .decor-layer{
      position:fixed;
      inset:0;
      z-index:1;
      pointer-events:none;
    }
    .decor{
      position:absolute;
      opacity:.7;
      filter: drop-shadow(0 10px 18px rgba(0,0,0,.12));
      font-size:22px;
      transform: translateZ(0);
    }
    .d1{top:14px; left:14px}
    .d2{top:14px; right:14px}
    .d3{bottom:14px; left:14px}
    .d4{bottom:14px; right:14px}
    .d5{top:92px; left:10px; opacity:.55; font-size:18px}
    .d6{top:120px; right:12px; opacity:.55; font-size:18px}
    .d7{bottom:96px; left:10px; opacity:.55; font-size:18px}
    .d8{bottom:120px; right:12px; opacity:.55; font-size:18px}

    .app{
      position:relative;
      z-index:2;
      min-height:100vh;
      display:flex;
      flex-direction:column;
      gap:14px;
      padding:18px 14px 24px;
      max-width:560px;
      margin:0 auto;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:10px 10px;
      border-radius:999px;
      background:var(--card);
      box-shadow: var(--shadow2);
      backdrop-filter: blur(12px);
    }

    .badge{
      display:flex;
      align-items:center;
      gap:10px;
      padding:8px 12px;
      border-radius:999px;
      background:#fff;
      box-shadow: 0 12px 25px rgba(31,35,64,.10);
      font-weight:700;
    }
    .dot{
      width:10px;height:10px;border-radius:99px;
      background: linear-gradient(180deg, #ff8cc7, #ff4f9b);
      box-shadow: 0 8px 16px rgba(255,79,155,.35);
    }

    .nav{
      display:flex;
      align-items:center;
      gap:10px;
    }

    .pill{
      border:none;
      border-radius:999px;
      padding:10px 12px;
      background:#fff;
      box-shadow: 0 12px 25px rgba(31,35,64,.10);
      color:var(--text);
      font-weight:800;
      cursor:pointer;
      display:flex;
      align-items:center;
      gap:10px;
      user-select:none;
      touch-action:manipulation;
    }

    .pill:active{transform:scale(.98)}
    .pill.primary{
      background: var(--btn);
      color: var(--btnText);
    }

    .progress{
      display:flex;
      gap:6px;
      padding:0 10px;
      align-items:center;
      justify-content:center;
    }
    .p{
      width:10px;height:10px;border-radius:999px;
      background:#ffffff90;
      box-shadow: 0 8px 18px rgba(31,35,64,.12);
    }
    .p.on{
      width:22px;
      background: linear-gradient(180deg, #ff8cc7, #7aa7ff);
    }

    .stage{
      position:relative;
      flex:1;
      display:flex;
      align-items:stretch;
      justify-content:center;
    }

    .card{
      width:100%;
      border-radius: var(--radius);
      background: var(--card2);
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
      overflow:hidden;
      position:relative;
      min-height: 72vh;
      display:none;
    }
    .card.show{display:block}

    .card-inner{
      padding:18px 16px 18px;
      min-height: 72vh;
      display:flex;
      flex-direction:column;
      gap:14px;
    }

    h1{
      margin:0;
      font-size:28px;
      letter-spacing:.2px;
      line-height:1.15;
    }
    p{
      margin:0;
      color:var(--muted);
      line-height:1.45;
      font-size:15px;
    }

    .actions{
      margin-top:auto;
      display:flex;
      gap:12px;
      padding:14px 16px 16px;
      position:sticky;
      bottom:0;
      background: linear-gradient(180deg, transparent, #ffffffcc 40%, #ffffffee);
      backdrop-filter: blur(10px);
    }
    .btn{
      border:none;
      border-radius: 16px;
      padding:14px 14px;
      font-weight:900;
      cursor:pointer;
      flex:1;
      user-select:none;
      touch-action:manipulation;
      box-shadow: 0 14px 30px rgba(31,35,64,.12);
    }
    .btn:active{transform:scale(.99)}
    .btn.secondary{
      background:#fff;
      color:var(--text);
    }
    .btn.primary{
      background: var(--btn);
      color: var(--btnText);
    }

    .mini{
      font-size:12px;
      padding:10px 12px;
      border-radius:999px;
      background:#fff;
      display:inline-flex;
      gap:8px;
      align-items:center;
      box-shadow: 0 12px 25px rgba(31,35,64,.10);
      width:max-content;
    }

    .game-area{
      position:relative;
      width:100%;
      height:54vh;
      border-radius: 20px;
      background:
        radial-gradient(900px 500px at 30% 15%, #fff7fc, transparent 60%),
        radial-gradient(900px 500px at 70% 30%, #f1f7ff, transparent 60%),
        linear-gradient(180deg, #ffffff, #ffffffb0);
      overflow:hidden;
      box-shadow: inset 0 0 0 1px rgba(31,35,64,.06);
    }

    #butterfly{
      position:absolute;
      width:84px;
      height:auto;
      cursor:pointer;
      user-select:none;
      touch-action:manipulation;
      filter: drop-shadow(0 12px 18px rgba(31,35,64,.14));
      transform: translateZ(0);
    }

    .float-hint{
      display:flex;
      gap:10px;
      align-items:flex-start;
      padding:12px 12px;
      border-radius:18px;
      background:#fff;
      box-shadow: 0 12px 25px rgba(31,35,64,.10);
    }
    .float-hint b{display:block}
    .float-hint span{color:var(--muted); font-size:14px; line-height:1.35}

    .cake-wrap{
      display:flex;
      align-items:center;
      justify-content:center;
      flex:1;
      padding:8px 0 0;
    }
    .cake{
      width:min(320px, 78vw);
      cursor:pointer;
      user-select:none;
      touch-action:manipulation;
      filter: drop-shadow(0 18px 35px rgba(31,35,64,.18));
      transform: translateZ(0);
    }

    .toggle-row{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }
    .toggle{
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      border-radius:16px;
      background:#fff;
      box-shadow: 0 12px 25px rgba(31,35,64,.10);
    }
    .switch{
      width:52px; height:30px;
      border-radius:999px;
      background:#e9ecff;
      position:relative;
      cursor:pointer;
      flex: 0 0 auto;
    }
    .knob{
      position:absolute;
      top:4px; left:4px;
      width:22px; height:22px;
      border-radius:999px;
      background:#fff;
      box-shadow: 0 12px 18px rgba(31,35,64,.18);
      transition: all .18s ease;
    }
    .switch.on{
      background: linear-gradient(180deg, #ff8cc7, #7aa7ff);
    }
    .switch.on .knob{left:26px}

    .grid{
      display:grid;
      grid-template-columns: repeat(2, 1fr);
      gap:12px;
    }
    .ph{
      aspect-ratio: 1/1;
      border-radius:18px;
      overflow:hidden;
      background:#fff;
      box-shadow: 0 12px 25px rgba(31,35,64,.10);
      position:relative;
    }
    .ph img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }

    .big-msg{
      padding:14px 14px;
      border-radius:20px;
      background:#fff;
      box-shadow: 0 12px 25px rgba(31,35,64,.10);
      font-size:15px;
      color:var(--muted);
      line-height:1.5;
    }

    .wishbox{
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .input{
      width:100%;
      border: 1px solid rgba(31,35,64,.10);
      background:#fff;
      border-radius:16px;
      padding:14px 14px;
      font-size:15px;
      outline:none;
    }
    .input:focus{
      border-color: rgba(122,167,255,.7);
      box-shadow: 0 0 0 4px rgba(122,167,255,.18);
    }

    .save-row{
      display:flex;
      gap:10px;
      align-items:center;
    }
    .save-row .btn{flex:0 0 auto; padding:12px 14px}
    .saved{
      font-size:13px;
      color: var(--muted);
    }

    .fade-in{
      animation: fi .24s ease both;
    }
    @keyframes fi{
      from{opacity:0; transform: translateY(6px)}
      to{opacity:1; transform: translateY(0)}
    }

    @media (max-width:380px){
      h1{font-size:24px}
      #butterfly{width:74px}
    }
  </style>
</head>
<body>
  <div class="decor-layer" aria-hidden="true">
    <span class="decor d1">üíñ</span>
    <span class="decor d2">‚ú®</span>
    <span class="decor d3">üå∑</span>
    <span class="decor d4">ü´ß</span>
    <span class="decor d5">üéÄ</span>
    <span class="decor d6">üíó</span>
    <span class="decor d7">üß∏</span>
    <span class="decor d8">‚ú®</span>
  </div>

  <div class="app">
    <div class="topbar">
      <div class="badge">
        <span class="dot"></span>
        <span>for you</span>
      </div>

      <div class="nav">
        <button class="pill" id="prevBtn">‚Äπ</button>
        <div class="progress" id="progress"></div>
        <button class="pill" id="nextBtn">‚Ä∫</button>
        <button class="pill primary" id="musicBtn">‚ñ∂Ô∏é</button>
      </div>
    </div>

    <div class="stage">
      <section class="card" data-slide="0">
        <div class="card-inner">
          <div class="mini">ü¶ã <b>Tangkap kupu-kupunya</b> <span id="scoreText" style="color:var(--muted); font-weight:700;">0</span></div>

          <h1>Mini game dulu</h1>
          <p>Kupu-kupunya kabur ke mana-mana. Tap dia buat nangkep. Nanti kupu-kupu ini bisa kamu ganti mukanya jadi muka orang.</p>

          <div class="game-area" id="gameArea">
            <img id="butterfly" src="assets/butterfly.png" alt="butterfly" draggable="false" />
          </div>

          <div class="float-hint">
            <div>üí°</div>
            <div>
              <b>Tips</b>
              <span>Kalau musik belum jalan, pencet tombol ‚ñ∂Ô∏é dulu. Setelah itu pindah slide pun musiknya tetep lanjut.</span>
            </div>
          </div>

          <div class="actions">
            <button class="btn secondary" id="resetGameBtn">Reset</button>
            <button class="btn primary" data-go="1">Lanjut</button>
          </div>
        </div>
      </section>

      <section class="card" data-slide="1">
        <div class="card-inner">
          <h1>Hai kamu ü´∂</h1>
          <p>Ini kecil-kecilan tapi niat. Semoga kamu senyum dulu sebelum lanjut ya.</p>

          <div class="big-msg">
            Kamu itu tipe orang yang kalau muncul di hidup seseorang, suasananya jadi lebih hangat.
            Jadi ya, sekarang kamu duduk manis dulu, nikmatin musiknya, terus lanjut pelan-pelan.
          </div>

          <div class="actions">
            <button class="btn secondary" data-go="0">Balik</button>
            <button class="btn primary" data-go="2">Lanjut</button>
          </div>
        </div>
      </section>

      <section class="card" data-slide="2">
        <div class="card-inner">
          <h1>Tiup kuenya üéÇ</h1>
          <p>Cukup tap kuenya buat ‚Äúmatiin lilin‚Äù. Kalau mau gaya-gayaan, bisa coba sensor tiup juga.</p>

          <div class="toggle-row">
            <div class="toggle">
              <div style="font-weight:800;">Sensor tiup (mic)</div>
              <div class="switch" id="micSwitch" role="switch" aria-checked="false">
                <div class="knob"></div>
              </div>
            </div>
            <div class="mini" id="micStatus">Mic: off</div>
          </div>

          <div class="cake-wrap">
            <img class="cake" id="cakeImg" src="assets/cake_on.gif" alt="cake" draggable="false" />
          </div>

          <div class="actions">
            <button class="btn secondary" data-go="1">Balik</button>
            <button class="btn primary" data-go="3">Lanjut</button>
          </div>
        </div>
      </section>

      <section class="card" data-slide="3">
        <div class="card-inner">
          <h1>Kenangan kecil üì∏</h1>
          <p>Ini tempat foto-foto kamu. Lu tinggal ganti file-nya di folder assets.</p>

          <div class="grid">
            <div class="ph"><img src="assets/photos/1.jpg" alt="photo1" /></div>
            <div class="ph"><img src="assets/photos/2.jpg" alt="photo2" /></div>
            <div class="ph"><img src="assets/photos/3.jpg" alt="photo3" /></div>
            <div class="ph"><img src="assets/photos/4.jpg" alt="photo4" /></div>
          </div>

          <div class="big-msg">
            Kadang yang bikin kangen itu bukan hal gede, tapi hal kecil yang keinget tiba-tiba.
            Nah ini salah satu caranya biar ‚Äútiba-tiba‚Äù itu ada tempatnya.
          </div>

          <div class="actions">
            <button class="btn secondary" data-go="2">Balik</button>
            <button class="btn primary" data-go="4">Lanjut</button>
          </div>
        </div>
      </section>

      <section class="card" data-slide="4">
        <div class="card-inner">
          <h1>Selamat ulang tahun üéâ</h1>
          <p>Semoga tahun ini kamu makin tenang, makin kuat, dan makin disayang.</p>

          <div class="big-msg">
            Semoga kamu dapet hal-hal baik yang kamu ga minta, tapi kamu pantas dapet.
            Semoga kamu ketemu versi hidup yang lebih lembut sama kamu.
            Dan semoga kalau capek, kamu inget: kamu ga sendirian.
          </div>

          <div class="actions">
            <button class="btn secondary" data-go="3">Balik</button>
            <button class="btn primary" data-go="5">Lanjut</button>
          </div>
        </div>
      </section>

      <section class="card" data-slide="5">
        <div class="card-inner">
          <h1>Wish kamu ‚ú®</h1>
          <p>Tulis harapan kamu. Simpen di sini, bukan cuma disimpen di kepala.</p>

          <div class="wishbox">
            <input class="input" id="wishInput" placeholder="Tulis wish kamu..." />
            <div class="save-row">
              <button class="btn primary" id="saveWishBtn">Simpan</button>
              <button class="btn secondary" id="clearWishBtn">Hapus</button>
              <div class="saved" id="savedText"></div>
            </div>
          </div>

          <div class="big-msg" id="wishPreview" style="display:none;"></div>

          <div class="actions">
            <button class="btn secondary" data-go="4">Balik</button>
            <button class="btn primary" data-go="0">Ulang dari awal</button>
          </div>
        </div>
      </section>
    </div>
  </div>

  <audio id="bgm" src="assets/music.mp3" preload="auto" loop></audio>

  <script>
    const slides = Array.from(document.querySelectorAll(".card"))
    const progress = document.getElementById("progress")
    const prevBtn = document.getElementById("prevBtn")
    const nextBtn = document.getElementById("nextBtn")

    const bgm = document.getElementById("bgm")
    const musicBtn = document.getElementById("musicBtn")
    let musicReady = false

    const gameArea = document.getElementById("gameArea")
    const butterfly = document.getElementById("butterfly")
    const scoreText = document.getElementById("scoreText")
    const resetGameBtn = document.getElementById("resetGameBtn")

    const cakeImg = document.getElementById("cakeImg")
    const micSwitch = document.getElementById("micSwitch")
    const micStatus = document.getElementById("micStatus")

    const wishInput = document.getElementById("wishInput")
    const saveWishBtn = document.getElementById("saveWishBtn")
    const clearWishBtn = document.getElementById("clearWishBtn")
    const savedText = document.getElementById("savedText")
    const wishPreview = document.getElementById("wishPreview")

    let current = 0

    function buildProgress() {
      progress.innerHTML = ""
      for (let i = 0; i < slides.length; i++) {
        const dot = document.createElement("div")
        dot.className = "p" + (i === current ? " on" : "")
        dot.addEventListener("click", () => go(i))
        progress.appendChild(dot)
      }
    }

    function showSlide(i) {
      slides.forEach((s, idx) => {
        s.classList.toggle("show", idx === i)
        if (idx === i) s.classList.add("fade-in")
        else s.classList.remove("fade-in")
      })
      buildProgress()
    }

    function go(i) {
      current = Math.max(0, Math.min(slides.length - 1, i))
      showSlide(current)
    }

    prevBtn.addEventListener("click", () => go(current - 1))
    nextBtn.addEventListener("click", () => go(current + 1))

    document.body.addEventListener("click", (e) => {
      const btn = e.target.closest("[data-go]")
      if (!btn) return
      go(Number(btn.getAttribute("data-go")))
    })

    async function toggleMusic() {
      try {
        if (bgm.paused) {
          await bgm.play()
          musicReady = true
          musicBtn.textContent = "‚è∏"
        } else {
          bgm.pause()
          musicBtn.textContent = "‚ñ∂Ô∏é"
        }
      } catch {
        musicBtn.textContent = "‚ñ∂Ô∏é"
      }
    }

    musicBtn.addEventListener("click", toggleMusic)

    let score = 0
    let moveTimer = null

    function clamp(n, min, max) {
      return Math.max(min, Math.min(max, n))
    }

    function rand(min, max) {
      return Math.random() * (max - min) + min
    }

    function moveButterfly(force) {
      const w = gameArea.clientWidth
      const h = gameArea.clientHeight
      const bw = butterfly.clientWidth || 84
      const bh = butterfly.clientHeight || 84

      const x = rand(10, w - bw - 10)
      const y = rand(10, h - bh - 10)

      const rot = rand(-18, 18)
      const flip = Math.random() < 0.5 ? -1 : 1
      butterfly.style.left = x + "px"
      butterfly.style.top = y + "px"
      butterfly.style.transform = `scaleX(${flip}) rotate(${rot}deg)` + (force ? " scale(1)" : "")
    }

    function startGame() {
      clearInterval(moveTimer)
      moveButterfly(true)
      moveTimer = setInterval(() => moveButterfly(false), 1100)
    }

    butterfly.addEventListener("click", () => {
      score++
      scoreText.textContent = score
      butterfly.style.transition = "transform .12s"
      butterfly.style.transform += " scale(0.75)"
      setTimeout(() => {
        butterfly.style.transition = ""
        moveButterfly(true)
      }, 140)
    })

    resetGameBtn.addEventListener("click", () => {
      score = 0
      scoreText.textContent = score
      startGame()
    })

    let candlesOn = true
    function setCandles(on) {
      candlesOn = on
      cakeImg.src = on ? "assets/cake_on.gif" : "assets/cake_off.png"
    }

    cakeImg.addEventListener("click", () => {
      setCandles(false)
      setTimeout(() => setCandles(true), 1200)
    })

    let micOn = false
    let audioCtx = null
    let analyser = null
    let micStream = null
    let micRAF = null

    function setSwitch(on) {
      micSwitch.classList.toggle("on", on)
      micSwitch.setAttribute("aria-checked", on ? "true" : "false")
      micStatus.textContent = "Mic: " + (on ? "on" : "off")
    }

    async function stopMic() {
      micOn = false
      setSwitch(false)
      if (micRAF) cancelAnimationFrame(micRAF)
      micRAF = null
      if (micStream) micStream.getTracks().forEach(t => t.stop())
      micStream = null
      analyser = null
      if (audioCtx) {
        try { await audioCtx.close() } catch {}
      }
      audioCtx = null
    }

    async function startMic() {
      try {
        micStream = await navigator.mediaDevices.getUserMedia({ audio: true })
        audioCtx = new (window.AudioContext || window.webkitAudioContext)()
        const source = audioCtx.createMediaStreamSource(micStream)
        analyser = audioCtx.createAnalyser()
        analyser.fftSize = 2048
        source.connect(analyser)
        micOn = true
        setSwitch(true)
        watchBlow()
      } catch {
        await stopMic()
      }
    }

    function watchBlow() {
      if (!analyser) return
      const data = new Uint8Array(analyser.fftSize)
      const tick = () => {
        analyser.getByteTimeDomainData(data)
        let sum = 0
        for (let i = 0; i < data.length; i++) {
          const v = (data[i] - 128) / 128
          sum += v * v
        }
        const rms = Math.sqrt(sum / data.length)
        if (rms > 0.22 && candlesOn) {
          setCandles(false)
          setTimeout(() => setCandles(true), 1300)
        }
        micRAF = requestAnimationFrame(tick)
      }
      tick()
    }

    micSwitch.addEventListener("click", async () => {
      if (micOn) await stopMic()
      else await startMic()
    })

    function loadWish() {
      const v = localStorage.getItem("wish_text") || ""
      if (v.trim()) {
        wishPreview.style.display = "block"
        wishPreview.textContent = "Wish kamu: " + v
        savedText.textContent = "Tersimpan ‚úÖ"
        wishInput.value = v
      } else {
        wishPreview.style.display = "none"
        savedText.textContent = ""
        wishInput.value = ""
      }
    }

    saveWishBtn.addEventListener("click", () => {
      const v = (wishInput.value || "").trim()
      localStorage.setItem("wish_text", v)
      loadWish()
    })

    clearWishBtn.addEventListener("click", () => {
      localStorage.removeItem("wish_text")
      loadWish()
    })

    document.addEventListener("visibilitychange", () => {
      if (document.hidden) return
      if (!bgm.paused && musicReady) {
        bgm.play().catch(() => {})
      }
    })

    window.addEventListener("resize", () => moveButterfly(true))

    showSlide(0)
    startGame()
    loadWish()
    setCandles(true)
    setSwitch(false)
  </script>
</body>
</html>