<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>For You</title>
  <style>
    :root{
      --bg1:#ffe9f4;
      --bg2:#e9f2ff;
      --card:#ffffffcc;
      --card2:#ffffffee;
      --text:#1f2340;
      --muted:#5c628a;
      --btn:#1f2340;
      --btnText:#fff;
      --shadow: 0 18px 45px rgba(31,35,64,.16);
      --shadow2: 0 10px 30px rgba(31,35,64,.10);
      --radius: 22px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 900px at 20% 10%, var(--bg1), transparent 55%),
        radial-gradient(1200px 900px at 80% 20%, var(--bg2), transparent 55%),
        linear-gradient(180deg, #fff2f8, #eef6ff);
      overflow-x:hidden;
    }

    .decor-layer{
      position:fixed;
      inset:0;
      z-index:1;
      pointer-events:none;
    }
    .decor{
      position:absolute;
      opacity:.7;
      filter: drop-shadow(0 10px 18px rgba(0,0,0,.10));
      font-size:20px;
      transform: translateZ(0);
    }
    .d1{top:14px; left:14px}
    .d2{top:14px; right:14px}
    .d3{bottom:14px; left:14px}
    .d4{bottom:14px; right:14px}
    .d5{top:92px; left:10px; opacity:.45; font-size:16px}
    .d6{top:120px; right:12px; opacity:.45; font-size:16px}
    .d7{bottom:96px; left:10px; opacity:.45; font-size:16px}
    .d8{bottom:120px; right:12px; opacity:.45; font-size:16px}

    .app{
      position:relative;
      z-index:2;
      min-height:100vh;
      display:flex;
      flex-direction:column;
      gap:14px;
      padding:18px 14px 24px;
      max-width:560px;
      margin:0 auto;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:10px 10px;
      border-radius:999px;
      background:var(--card);
      box-shadow: var(--shadow2);
      backdrop-filter: blur(12px);
    }

    .badge{
      display:flex;
      align-items:center;
      gap:10px;
      padding:8px 12px;
      border-radius:999px;
      background:#fff;
      box-shadow: 0 12px 25px rgba(31,35,64,.08);
      font-weight:800;
    }
    .dot{
      width:10px;height:10px;border-radius:99px;
      background: linear-gradient(180deg, #ff8cc7, #7aa7ff);
      box-shadow: 0 8px 16px rgba(122,167,255,.25);
    }

    .nav{
      display:flex;
      align-items:center;
      gap:10px;
    }

    .pill{
      border:none;
      border-radius:999px;
      padding:10px 12px;
      background:#fff;
      box-shadow: 0 12px 25px rgba(31,35,64,.08);
      color:var(--text);
      font-weight:900;
      cursor:pointer;
      display:flex;
      align-items:center;
      gap:10px;
      user-select:none;
      touch-action:manipulation;
    }
    .pill:active{transform:scale(.98)}

    .progress{
      display:flex;
      gap:6px;
      padding:0 6px;
      align-items:center;
      justify-content:center;
    }
    .p{
      width:10px;height:10px;border-radius:999px;
      background:#ffffff90;
      box-shadow: 0 8px 18px rgba(31,35,64,.10);
      cursor:pointer;
    }
    .p.on{
      width:22px;
      background: linear-gradient(180deg, #ff8cc7, #7aa7ff);
    }

    .stage{
      position:relative;
      flex:1;
      display:flex;
      align-items:stretch;
      justify-content:center;
    }

    .card{
      width:100%;
      border-radius: var(--radius);
      background: var(--card2);
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
      overflow:hidden;
      position:relative;
      min-height: 72vh;
      display:none;
    }
    .card.show{display:block}

    .card-inner{
      padding:18px 16px 18px;
      min-height: 72vh;
      display:flex;
      flex-direction:column;
      gap:14px;
    }

    h1{margin:0;font-size:28px;letter-spacing:.2px;line-height:1.15}
    p{margin:0;color:var(--muted);line-height:1.45;font-size:15px}

    .actions{
      margin-top:auto;
      display:flex;
      gap:12px;
      padding:14px 16px 16px;
      position:sticky;
      bottom:0;
      background: linear-gradient(180deg, transparent, #ffffffcc 40%, #ffffffee);
      backdrop-filter: blur(10px);
    }

    .btn{
      border:none;
      border-radius: 16px;
      padding:14px 14px;
      font-weight:900;
      cursor:pointer;
      flex:1;
      user-select:none;
      touch-action:manipulation;
      box-shadow: 0 14px 30px rgba(31,35,64,.10);
    }
    .btn:active{transform:scale(.99)}
    .btn.secondary{background:#fff;color:var(--text)}
    .btn.primary{background: var(--btn);color: var(--btnText)}

    .mini{
      font-size:12px;
      padding:10px 12px;
      border-radius:999px;
      background:#fff;
      display:inline-flex;
      gap:10px;
      align-items:center;
      box-shadow: 0 12px 25px rgba(31,35,64,.08);
      width:max-content;
      font-weight:800;
    }
    .mini .mut{font-weight:900;color:var(--muted)}

    .game-area{
      position:relative;
      width:100%;
      height:54vh;
      border-radius: 20px;
      background:
        radial-gradient(900px 500px at 30% 15%, #fff7fc, transparent 60%),
        radial-gradient(900px 500px at 70% 30%, #f1f7ff, transparent 60%),
        linear-gradient(180deg, #ffffff, #ffffffb0);
      overflow:hidden;
      box-shadow: inset 0 0 0 1px rgba(31,35,64,.06);
    }

    #butterfly{
      position:absolute;
      width:86px;
      height:auto;
      cursor:pointer;
      user-select:none;
      touch-action:manipulation;
      filter: drop-shadow(0 12px 18px rgba(31,35,64,.14));
      transform: translateZ(0);
      will-change: transform, left, top;
    }

    .overlay{
      position:absolute;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      padding:18px;
      background: rgba(255,255,255,.55);
      backdrop-filter: blur(8px);
      z-index:5;
    }
    .overlay.show{display:flex}
    .overlay-card{
      width:min(390px, 92%);
      background:#fff;
      border-radius:20px;
      box-shadow: var(--shadow2);
      padding:16px;
      text-align:center;
    }
    .overlay-card b{font-size:18px}
    .overlay-card p{margin:10px 0 12px}
    .overlay-actions{
      display:flex;
      gap:10px;
    }

    .big-msg{
      padding:14px 14px;
      border-radius:20px;
      background:#fff;
      box-shadow: 0 12px 25px rgba(31,35,64,.08);
      font-size:15px;
      color:var(--muted);
      line-height:1.5;
    }

    .cake-wrap{
      display:flex;
      align-items:center;
      justify-content:center;
      flex:1;
      padding:8px 0 0;
    }
    .cake{
      width:min(320px, 78vw);
      cursor:pointer;
      user-select:none;
      touch-action:manipulation;
      filter: drop-shadow(0 18px 35px rgba(31,35,64,.16));
      transform: translateZ(0);
    }

    .toggle-row{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }
    .toggle{
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      border-radius:16px;
      background:#fff;
      box-shadow: 0 12px 25px rgba(31,35,64,.08);
    }
    .switch{
      width:52px; height:30px;
      border-radius:999px;
      background:#e9ecff;
      position:relative;
      cursor:pointer;
      flex: 0 0 auto;
    }
    .knob{
      position:absolute;
      top:4px; left:4px;
      width:22px; height:22px;
      border-radius:999px;
      background:#fff;
      box-shadow: 0 12px 18px rgba(31,35,64,.14);
      transition: all .18s ease;
    }
    .switch.on{
      background: linear-gradient(180deg, #ff8cc7, #7aa7ff);
    }
    .switch.on .knob{left:26px}

    .fade-in{animation: fi .24s ease both}
    @keyframes fi{
      from{opacity:0; transform: translateY(6px)}
      to{opacity:1; transform: translateY(0)}
    }

    @media (max-width:380px){
      h1{font-size:24px}
      #butterfly{width:76px}
    }
  </style>
</head>
<body>
  <div class="decor-layer" aria-hidden="true">
    <span class="decor d1">üíñ</span>
    <span class="decor d2">‚ú®</span>
    <span class="decor d3">üå∑</span>
    <span class="decor d4">ü´ß</span>
    <span class="decor d5">üéÄ</span>
    <span class="decor d6">üíó</span>
    <span class="decor d7">üß∏</span>
    <span class="decor d8">‚ú®</span>
  </div>

  <div class="app">
    <div class="topbar">
      <div class="badge">
        <span class="dot"></span>
        <span>for you</span>
      </div>

      <div class="nav">
        <button class="pill" id="prevBtn">‚Äπ</button>
        <div class="progress" id="progress"></div>
        <button class="pill" id="nextBtn">‚Ä∫</button>
      </div>
    </div>

    <div class="stage">
      <section class="card" data-slide="0">
        <div class="card-inner">
          <div class="mini">
            ü¶ã Tangkap: <span id="scoreText" class="mut">0/10</span>
            ‚è±Ô∏è <span id="timeText" class="mut">25</span>s
          </div>

          <h1>Mini game dulu</h1>
          <p>Tap kupu-kupu yang kabur. Target 10 tangkapan sebelum 25 detik.</p>

          <div class="game-area" id="gameArea">
            <img id="butterfly" src="assets/butterfly.png" alt="butterfly" draggable="false" />

            <div class="overlay" id="gameOverlay">
              <div class="overlay-card">
                <b id="gameOverTitle">Waktu habis</b>
                <p id="gameOverText">Skor kamu 0/10. Ulangi dulu ya.</p>
                <div class="overlay-actions">
                  <button class="btn secondary" id="retryBtn">Ulangi</button>
                  <button class="btn primary" id="skipBtn">Skip aja</button>
                </div>
              </div>
            </div>
          </div>

          <div class="big-msg">
            Menang = lanjut otomatis ke musik. Kalah = muncul tombol ulangi. Simple, ga drama.
          </div>
        </div>
      </section>

      <section class="card" data-slide="1">
        <div class="card-inner">
          <h1>Menu musik ü´∂</h1>
          <p>Di Klik Play Yaa, Biar Ada Musiknya!</p>

          <div class="big-msg">
            Kalo Udah, Boleh Lanjut Kok..
          </div>

          <div class="actions">
            <button class="btn secondary" data-go="0">Balik</button>
            <button class="btn primary" id="musicBtn">‚ñ∂Ô∏é Play Musik</button>
            <button class="btn primary" data-go="2">Lanjut</button>
          </div>
        </div>
      </section>

      <section class="card" data-slide="2">
        <div class="card-inner">
          <h1>Tiup kuenya!!! üéÇ</h1>
          <p>Sampe Lilin nya Mati Yaaa</p>

          <div class="toggle-row">
            <div class="toggle">
              <div style="font-weight:900;">Sensor tiup (mic)</div>
              <div class="switch" id="micSwitch" role="switch" aria-checked="false">
                <div class="knob"></div>
              </div>
            </div>
            <div class="mini" id="micStatus">Mic: off</div>
          </div>

          <div class="cake-wrap">
            <img class="cake" id="cakeImg" src="assets/cake_on.gif" alt="cake" draggable="false" />
          </div>

          <div class="big-msg" id="cakeHint">
            Kalo Gabisa di Tiup, di Tap Aja Kue nya
          </div>

          <div class="actions">
            <button class="btn secondary" data-go="1">Balik</button>
            <button class="btn primary" id="cakeNextBtn" disabled style="opacity:.55;">Lanjut</button>
          </div>
        </div>
      </section>

      <section class="card" data-slide="3">
        <div class="card-inner">
          <h1>Selamat ulang tahun üéâ</h1>
          <p>Semoga hari ini kamu merasa disayang, bukan cuma diucapin.</p>

          <div class="big-msg">
            Happy Birthday seiras heartifilia aka fadiaa.
            semogaa di umur kamu yang bertambah satu tahun inii 
            kamuu bisa menjadii pribadi yang lebihh baik lagiii,
            menjadi pribadi yang semakin kuat. terimakasihhh ya seii 
            karena sudah bertahan sampee hari inii,
            terimakasih karena selalu milih bertahan dari banyaknya kata
            ingin menyerah yang mungkin sering sekali terucap atau terpikirkan
            oleh kamuuu. aku bangga kamu bisaa sampe di titik iniii
            <br><br>
            Ulang tahun itu bukan cuma nambah umur, tapi nambah alasan buat bangga kamu masih bertahan.
          </div>

          <div class="actions">
            <button class="btn secondary" data-go="2">Balik</button>
            <button class="btn primary" data-go="0">Ulang dari awal</button>
          </div>
        </div>
      </section>
    </div>
  </div>

  <audio id="bgm" src="assets/music.mp3" preload="auto" loop></audio>

  <script>
    const slides = Array.from(document.querySelectorAll(".card"))
    const progress = document.getElementById("progress")
    const prevBtn = document.getElementById("prevBtn")
    const nextBtn = document.getElementById("nextBtn")

    const bgm = document.getElementById("bgm")
    const musicBtn = document.getElementById("musicBtn")

    const gameArea = document.getElementById("gameArea")
    const butterfly = document.getElementById("butterfly")
    const scoreText = document.getElementById("scoreText")
    const timeText = document.getElementById("timeText")

    const gameOverlay = document.getElementById("gameOverlay")
    const gameOverTitle = document.getElementById("gameOverTitle")
    const gameOverText = document.getElementById("gameOverText")
    const retryBtn = document.getElementById("retryBtn")
    const skipBtn = document.getElementById("skipBtn")

    const cakeImg = document.getElementById("cakeImg")
    const micSwitch = document.getElementById("micSwitch")
    const micStatus = document.getElementById("micStatus")
    const cakeNextBtn = document.getElementById("cakeNextBtn")
    const cakeHint = document.getElementById("cakeHint")

    let current = 0

    function buildProgress() {
      progress.innerHTML = ""
      for (let i = 0; i < slides.length; i++) {
        const dot = document.createElement("div")
        dot.className = "p" + (i === current ? " on" : "")
        dot.addEventListener("click", () => go(i))
        progress.appendChild(dot)
      }
    }

    function showSlide(i) {
      slides.forEach((s, idx) => {
        s.classList.toggle("show", idx === i)
        if (idx === i) s.classList.add("fade-in")
        else s.classList.remove("fade-in")
      })
      buildProgress()
      onSlideEnter(i)
    }

    function go(i) {
      current = Math.max(0, Math.min(slides.length - 1, i))
      showSlide(current)
    }

    prevBtn.addEventListener("click", () => go(current - 1))
    nextBtn.addEventListener("click", () => go(current + 1))

    document.body.addEventListener("click", (e) => {
      const btn = e.target.closest("[data-go]")
      if (!btn) return
      go(Number(btn.getAttribute("data-go")))
    })

    async function toggleMusic() {
      try {
        if (bgm.paused) {
          await bgm.play()
          musicBtn.textContent = "‚è∏ Pause Musik"
        } else {
          bgm.pause()
          musicBtn.textContent = "‚ñ∂Ô∏é Play Musik"
        }
      } catch {
        musicBtn.textContent = "‚ñ∂Ô∏é Play Musik"
      }
    }
    if (musicBtn) musicBtn.addEventListener("click", toggleMusic)

    function rand(min, max) { return Math.random() * (max - min) + min }

    let score = 0
    let timeLeft = 25
    let moveTimer = null
    let countdownTimer = null
    let gameRunning = false
    let gameEnded = false

    function moveButterfly() {
      const w = gameArea.clientWidth
      const h = gameArea.clientHeight
      const bw = butterfly.clientWidth || 86
      const bh = butterfly.clientHeight || 86

      const x = rand(10, w - bw - 10)
      const y = rand(10, h - bh - 10)

      const rot = rand(-18, 18)
      const flip = Math.random() < 0.5 ? -1 : 1
      butterfly.style.left = x + "px"
      butterfly.style.top = y + "px"
      butterfly.style.transform = `scaleX(${flip}) rotate(${rot}deg)`
    }

    function updateHud() {
      scoreText.textContent = `${score}/10`
      timeText.textContent = String(timeLeft)
    }

    function stopGame() {
      gameRunning = false
      clearInterval(moveTimer)
      clearInterval(countdownTimer)
      moveTimer = null
      countdownTimer = null
    }

    function showOverlay(title, text) {
      gameOverTitle.textContent = title
      gameOverText.textContent = text
      gameOverlay.classList.add("show")
    }

    function hideOverlay() {
      gameOverlay.classList.remove("show")
    }

    function endGame(success) {
      if (gameEnded) return
      gameEnded = true
      stopGame()
      if (success) {
        hideOverlay()
        setTimeout(() => go(1), 350)
      } else {
        showOverlay("Waktu habis ‚è±Ô∏è", `Skor kamu ${score}/10. Ulangi dulu ya.`)
      }
    }

    function startGame() {
      stopGame()
      hideOverlay()
      score = 0
      timeLeft = 25
      gameRunning = true
      gameEnded = false
      updateHud()
      moveButterfly()

      moveTimer = setInterval(() => {
        if (!gameRunning) return
        moveButterfly()
      }, 650)

      countdownTimer = setInterval(() => {
        if (!gameRunning) return
        timeLeft -= 1
        updateHud()
        if (timeLeft <= 0) endGame(false)
      }, 1000)
    }

    butterfly.addEventListener("click", () => {
      if (!gameRunning || gameEnded) return
      score += 1
      updateHud()
      butterfly.style.transition = "transform .10s"
      butterfly.style.transform += " scale(0.78)"
      setTimeout(() => {
        butterfly.style.transition = ""
        moveButterfly()
      }, 110)
      if (score >= 10) endGame(true)
    })

    retryBtn.addEventListener("click", () => startGame())
    skipBtn.addEventListener("click", () => {
      hideOverlay()
      go(1)
    })

    let candlesOn = true
    function setCandles(on) {
      candlesOn = on
      cakeImg.src = on ? "assets/cake_on.gif" : "assets/cake_off.png"
      if (!on) {
        cakeNextBtn.disabled = false
        cakeNextBtn.style.opacity = "1"
        cakeHint.textContent = "Lilin udah mati. Sekarang lanjut."
      }
    }

    cakeImg.addEventListener("click", () => {
      if (!candlesOn) return
      setCandles(false)
    })

    cakeNextBtn.addEventListener("click", () => {
      if (candlesOn) return
      go(3)
    })

    let micOn = false
    let audioCtx = null
    let analyser = null
    let micStream = null
    let micRAF = null

    function setSwitch(on) {
      micSwitch.classList.toggle("on", on)
      micSwitch.setAttribute("aria-checked", on ? "true" : "false")
      micStatus.textContent = "Mic: " + (on ? "on" : "off")
    }

    async function stopMic() {
      micOn = false
      setSwitch(false)
      if (micRAF) cancelAnimationFrame(micRAF)
      micRAF = null
      if (micStream) micStream.getTracks().forEach(t => t.stop())
      micStream = null
      analyser = null
      if (audioCtx) {
        try { await audioCtx.close() } catch {}
      }
      audioCtx = null
    }

    async function startMic() {
      try {
        micStream = await navigator.mediaDevices.getUserMedia({ audio: true })
        audioCtx = new (window.AudioContext || window.webkitAudioContext)()
        const src = audioCtx.createMediaStreamSource(micStream)
        analyser = audioCtx.createAnalyser()
        analyser.fftSize = 1024
        src.connect(analyser)
        micOn = true
        setSwitch(true)
        listenBlow()
      } catch {
        stopMic()
      }
    }

    function rms(buf) {
      let sum = 0
      for (let i = 0; i < buf.length; i++) {
        const v = (buf[i] - 128) / 128
        sum += v * v
      }
      return Math.sqrt(sum / buf.length)
    }

    function listenBlow() {
      if (!analyser || !micOn) return
      const data = new Uint8Array(analyser.fftSize)
      const tick = () => {
        if (!analyser || !micOn) return
        analyser.getByteTimeDomainData(data)
        const level = rms(data)
        if (candlesOn && level > 0.20) {
          setCandles(false)
          stopMic()
          ret
        return
        }
        micRAF = requestAnimationFrame(tick)
      }
      micRAF = requestAnimationFrame(tick)
    }

    micSwitch.addEventListener("click", () => {
      if (!micOn) startMic()
      else stopMic()
    })

    function onSlideEnter(i) {
      if (i === 0) startGame()
      else stopGame()

      if (i !== 2) stopMic()

      if (i === 2) {
        cakeNextBtn.disabled = candlesOn
        cakeNextBtn.style.opacity = candlesOn ? ".55" : "1"
      }
    }

    go(0)
  </script>
</body>
</html>